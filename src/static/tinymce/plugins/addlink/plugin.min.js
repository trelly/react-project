tinymce.PluginManager.add('addlink', function(editor, url) {
    var panel = function(editor) {
        var win = editor.windowManager.open({
            title: '插入链接',
            width: 428,
            height: 100,
            method: 'POST',
            body: [{
                label: '文章地址',
                type: 'textbox',
                name: "url"
            }],
            onsubmit: function(e) {
                e.preventDefault();
                $.post('/article/get_title_by_url/', {
                    url: e.data.url
                }).done(function(json) {
                    if (json.message == 'error') {
                        editor.notificationManager.open({
                            text: '获取文章失败，请输入有效的文章链接',
                            type: 'error',
                            timeout: 2000
                        });
                    } else {
                        var link = editor.dom.createHTML('a', {
                            href: json.data.url
                        }, json.data.title);
                        editor.insertContent(link);
                        win.close();
                    }
                }).fail(function(data) {
                    editor.notificationManager.open({
                        type: 'error',
                        text: '接口请求错误',
                        timeout: 2000
                    });
                });
            }
        });
    };
    editor.addButton('addlink', {
        icon: 'article',
        title: '插入文章',
        onclick: function() {
            panel(editor);
        }
    });
});
